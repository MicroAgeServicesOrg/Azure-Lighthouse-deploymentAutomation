{
    "properties": {
        "displayName": "Azure Resource Tagging - AzMSP_Baseline",
        "policyType": "Custom",
        "description": "Ensure that Virtual Machines, SQL Databases, and Recovery Services vaults have tags.",
        "metadata": {
            "category": "AzMSP_Baseline"
        }
    },
    "policyRule":{
        "if": {
            "allOf": [
              {
                "field": "type",
                "in": [
                  "Microsoft.Compute/virtualMachines",
                  "Microsoft.Sql/servers/databases",
                  "Microsoft.RecoveryServices/vaults"
                ]
              },
              {
                "field": "[concat('tags[MicroAge AzMSP]')]",
                "exists": "false"
              }
            ]
          },
          "then": {
            "effect": "modify",
            "details": {
                "roleDefinitionsIds": [
                    "/providers/Microsoft.Authorization/roleDefinitions/4a9ae827-6dc8-4573-8ac7-8239d42aa03f"
                ],
                "operations": [
                    {
                        "operation": "add",
                        "field": "tags['MicroAge AzMSP']",
                        "value": "true"
                    }
                ]
            } 
          }
    }
}